<!DOCTYPE html>
<html lang="ja">
	<head>
		<title>Amazon 商品広告管理</title>

		<meta name="viewport" content="width=device-width,initial-scale=1" />

		<link rel="stylesheet" href="/assets/style/admin.css" />
		<link rel="stylesheet" href="/assets/style/layout_full.css" title="通常表示" />
		<link rel="alternate stylesheet" href="/assets/style/layout_reader.css" title="リーダー表示" />
		<link rel="stylesheet" href="/assets/style/layout_reader.css" media="print" />

		<script src="/assets/script/w0s.mjs" type="module"></script>
	</head>
	<body>
		<div class="l-page">
			<%- include('./_include/_header') -%>

			<div id="content" class="l-content -nosidebar">
				<div class="l-content__header">
					<div class="p-title">
						<h1>Amazon 商品広告管理</h1>
					</div>
				</div>
				<main class="l-content__main">
					<section class="p-section -hdg-a">
						<div class="p-section__hdg">
							<h2>新規追加</h2>
						</div>

						<form method="post" class="c-stack">
							<%_ if (validateErrors.length > 0) { _%>
							<div class="p-form-errors js-autofocus">
								<p><strong><%= validateErrors.length %>個のエラーがあります。</strong></p>
								<ul class="p-list">
									<%_ for (const validateError of validateErrors) { _%>
									<li><%= validateError.msg %></li>
									<%_ } _%>
								</ul>
							</div>
							<%_ } _%>

							<div class="p-form-grid">
								<div class="p-form-grid__group">
									<fieldset>
										<legend class="p-form-grid__legend"><label for="fc-asin" class="c-label">ASIN</label></legend>
										<div class="p-form-grid__contents">
											<input class="c-input" id="fc-asin" name="asin" value="<%= page.query.asin %>" minlength="10" maxlength="10" required="" pattern="[\dA-Z]{10}" style="--width: 10em" />
										</div>
									</fieldset>
								</div>
								<div class="p-form-grid__group">
									<fieldset>
										<legend class="p-form-grid__legend">カテゴリー</legend>
										<div class="p-form-grid__contents">
											<div class="c-form-controls -checkbox">
												<%_ for (const category of categoryMaster) { _%>
												<label class="c-label -check">
													<%_ if (page.query.category !== null && page.query.category.includes(category.id)) { _%>
													<input type="checkbox" name="category[]" value="<%= category.id %>" checked="" />
													<%_ } else { _%>
													<input type="checkbox" name="category[]" value="<%= category.id %>" />
													<%_ } _%>
													<span class="c-label__text"><%= category.name %></span>
												</label>
												<%_ } _%>
											</div>
										</div>
									</fieldset>
								</div>
							</div>

							<div class="c-form-controls -submit">
								<p><button class="c-submit" name="actionadd" value="1">新規追加</button></p>
							</div>
						</form>
					</section>

					<%_ for (const [categoryName, dpOfCategory] of dpList) { _%>
					<section class="p-section -hdg-a">
						<div class="p-section__hdg">
							<h2><%= categoryName %></h2>
						</div>

						<ul class="c-grid -wide">
							<%_ for (const dp of dpOfCategory) { _%>
							<li class="c-grid__item">
								<div class="p-box">
									<form method="post">
										<p class="c-form-controls">
											<input type="hidden" name="asin" value="<%= dp.asin %>" />
											<button name="actiondel" value="1" is="w0s-confirm-button" data-message="削除しますか?" class="c-submit -compact">削除</button>
											<span><%= dp.asin %></span>
										</p>
									</form>

									<div class="p-embed-link">
										<a href="https://www.amazon.co.jp/dp/<%= dp.asin %>">
											<%_ if (dp.image_url !== null) { _%>
											<img src="<%= dp.image_url %>" srcset="<%= dp.image_url_2x + ' 2x' %>" alt="" />
											<%_ } else { _%>
											<img src="/assets/image/amazon_noimage.svg" alt="" width="113" height="160" />
											<%_ } _%>
											<span class="p-embed-link__title"><%= dp.title %><% if (dp.binding !== null) { %> <b>[<%= dp.binding %>]</b><% } %><% if (dp.date !== null) { %>（<time datetime="<%= dp.date.format('YYYY-MM-DD') %>"><%= dp.date.format('YYYY年M月D日') %></time>）<% } %></span>
										</a>
									</div>

									<%_ if (dp.image_url !== null) { _%>
									<dl class="p-list-description">
										<dt>画像 URL</dt>
										<dd><%= dp.image_url %></dd>
									</dl>
									<%_ } _%>
								</div>
							</li>
							<%_ } _%>
						</ul>
					</section>
					<%_ } _%>
				</main>
			</div>

			<%- include('./_include/_footer') -%>
		</div>
	</body>
</html>
