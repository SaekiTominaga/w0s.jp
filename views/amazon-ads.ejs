<!DOCTYPE html>
<html lang="ja">
	<head>
		<title>Amazon 商品広告管理</title>

		<meta name="viewport" content="width=device-width,initial-scale=1" />

		<link rel="stylesheet" href="/assets/style/admin.css" />
		<link rel="stylesheet" href="/assets/style/layout_full.css" title="通常表示" />
		<link rel="alternate stylesheet" href="/assets/style/layout_reader.css" title="リーダー表示" id="stylesheet-print" />

		<script src="/assets/script/w0s.mjs" type="module"></script>
	</head>
	<body>
		<div class="l-page">
			<%- include('./_include/_header') %>

			<div id="content" class="l-content -nosidebar">
				<div class="l-content__header">
					<div class="p-title">
						<h1>Amazon 商品広告管理</h1>
					</div>
				</div>
				<main class="l-content__main">
					<section class="p-section -hdg-a">
						<div class="p-section__hdg">
							<h2>新規追加</h2>
						</div>

						<form action="<%= page.path %>" method="post" class="c-stack">
							<% if (validateErrors.length > 0) { %>
							<div class="p-form-errors js-form-errors">
								<p><strong><%= validateErrors.length %>個のエラーがあります。</strong></p>
								<ul class="p-list">
									<% for (const validateError of validateErrors) { %>
									<li><%= validateError.msg %></li>
									<% } %>
								</ul>
							</div>
							<% } %>

							<div class="p-form-grid">
								<div class="p-form-grid__group">
									<fieldset>
										<legend class="p-form-grid__legend"><label for="fc-asin" class="c-label">ASIN</label></legend>
										<div class="p-form-grid__contents">
											<input class="c-input" id="fc-asin" name="asin" value="<%= page.query.asin %>" minlength="10" maxlength="10" required="" pattern="[\dA-Z]{10}" style="--width: 10em" />
										</div>
									</fieldset>
								</div>
								<div class="p-form-grid__group">
									<fieldset>
										<legend class="p-form-grid__legend">カテゴリー</legend>
										<div class="p-form-grid__contents">
											<div class="c-form-controls -checkbox">
												<% for (const category of categoryMaster) { %>
												<label class="c-label -check">
													<% if (page.query.category !== null && page.query.category.includes(category.id)) { %>
													<input type="checkbox" name="category[]" value="<%= category.id %>" checked="" />
													<% } else { %>
													<input type="checkbox" name="category[]" value="<%= category.id %>" />
													<% } %>
													<span class="c-label__text"><%= category.name %></span>
												</label>
												<% } %>
											</div>
										</div>
									</fieldset>
								</div>
							</div>

							<div class="c-form-controls -submit">
								<p><button class="c-submit" name="actionadd" value="1">新規追加</button></p>
							</div>
						</form>
					</section>

					<% for (const [categoryName, dpOfCategory] of dpList) { %>
					<section class="p-section -hdg-a">
						<div class="p-section__hdg">
							<h2><%= categoryName %></h2>
						</div>

						<ul class="c-grid -wide">
							<% for (const dp of dpOfCategory) { %>
							<li class="c-grid__item">
								<div class="p-box">
									<form action="<%= page.path %>" method="post">
										<p class="c-form-controls">
											<input type="hidden" name="asin" value="<%= dp.asin %>" />
											<button name="actiondel" value="1" is="w0s-confirm-button" data-message="削除しますか?">削除</button>
											<span><%= dp.asin %></span>
										</p>
									</form>

									<div class="p-item">
										<a href="https://www.amazon.co.jp/dp/<%= dp.asin %>">
											<% if (dp.image_url !== null) { %>
											<img src="<%= dp.image_url %>" srcset="<%= dp.image_url_2x %> 2x" alt="" class="p-item__image" />
											<% } else { %>
											<img src="/assets/image/amazon_noimage.svg" alt="" class="p-item__image" />
											<% } %> <% if (dp.binding !== null) { %>
											<span class="p-item__title"><%= dp.title %></span>
											<% } else { %>
											<span class="p-item__title"><%= dp.title %><b>[<%= dp.binding %>]</b></span>
											<% } %>
										</a>
										<% if (dp.date !== null) { %>
										<div class="p-item__text">
											<p><%= dp.date.format('YYYY年M月D日') %></p>
										</div>
										<% } %>
									</div>

									<dl class="p-list-description">
										<dt>商品ページ URL</dt>
										<dd><%= dp.url %></dd>
										<% if (dp.image_url !== null) { %>
										<dt>画像 URL</dt>
										<dd><%= dp.image_url %></dd>
										<% } %>
									</dl>
								</div>
							</li>
							<% } %>
						</ul>
					</section>
					<% } %>
				</main>
			</div>

			<%- include('./_include/_footer') %>
		</div>
	</body>
</html>
