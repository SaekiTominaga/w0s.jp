<!DOCTYPE html>
<html lang="ja">
	<head>
		<title>Amazon 商品広告管理</title>

		<meta name="viewport" content="width=device-width,initial-scale=1" />

		<link rel="stylesheet" href="/assets/style/admin.css" />
		<link rel="stylesheet" href="/assets/style/layout_full.css" title="通常表示" />
		<link rel="alternate stylesheet" href="/assets/style/layout_reader.css" title="リーダー表示" id="stylesheet-print" />

		<script src="/assets/script/w0s.mjs" type="module"></script>
	</head>
	<body>
		<div class="l-page">
			<%- include('./_include/_header') %>

			<main id="main" class="l-main -nosidebar">
				<div class="l-main__header">
					<div class="p-page-title">
						<h1>Amazon 商品広告管理</h1>
					</div>
				</div>
				<div class="l-main__main">
					<section class="p-section -hdg-a">
						<div class="p-hdg">
							<h2 class="p-hdg__hdg">新規追加</h2>
						</div>

						<form action="<%= page.path %>" method="post">
							<% if (validateErrors.length > 0) { %>
							<div class="p-form-errors js-form-errors">
								<p><strong><%= validateErrors.length %>個のエラーがあります。</strong></p>
								<ul>
									<% for (const validateError of validateErrors) { %>
									<li><%= validateError.msg %></li>
									<% } %>
								</ul>
							</div>
							<% } %>

							<div class="p-form-grid">
								<div class="p-form-grid__group">
									<fieldset>
										<legend class="p-form-grid__legend"><label for="fc-asin">ASIN</label></legend>
										<div class="p-form-grid__contents">
											<div class="p-form-grid__contents-block">
												<input
													class="c-input"
													id="fc-asin"
													name="asin"
													value="<%= page.query.asin %>"
													minlength="10"
													maxlength="10"
													required=""
													pattern="[\dA-Z]{10}"
													style="--input-width: 10em"
												/>
											</div>
										</div>
									</fieldset>
								</div>
								<div class="p-form-grid__group">
									<fieldset>
										<legend class="p-form-grid__legend">カテゴリー</legend>
										<div class="p-form-grid__contents">
											<div class="p-form-grid__contents-block -check">
												<% for (const category of categoryMaster) { %>
												<label class="c-label-check -checkbox">
													<% if (page.query.category !== null && page.query.category.includes(category.id)) { %>
													<input type="checkbox" name="category[]" value="<%= category.id %>" checked="" />
													<% } else { %>
													<input type="checkbox" name="category[]" value="<%= category.id %>" />
													<% } %>
													<span class="c-label-check__label"><%= category.name %></span>
												</label>
												<% } %>
											</div>
										</div>
									</fieldset>
								</div>
							</div>

							<div class="p-submit">
								<span class="p-submit__button"><button class="c-button-submit" name="actionadd" value="1">新規追加</button></span>
							</div>
						</form>
					</section>

					<% for (const [categoryName, dpOfCategory] of dpList) { %>
					<section class="p-section -hdg-a">
						<div class="p-hdg">
							<h2 class="p-hdg__hdg"><%= categoryName %></h2>
						</div>

						<ul class="p-admin-astore-list">
							<% for (const dp of dpOfCategory) { %>
							<li>
								<form action="<%= page.path %>" method="post" class="p-admin-astore-list__ctrl">
									<p><input type="hidden" name="asin" value="<%= dp.asin %>" /></p>
									<p>
										<button name="actiondel" value="1" is="w0s-confirm-button" data-message="削除しますか?">削除</button>
										<span class="p-admin-astore-list__asin"><%= dp.asin %></span>
									</p>
								</form>
								<div class="p-admin-astore-list__link">
									<a href="https://www.amazon.co.jp/dp/<%= dp.asin %>">
										<% if (dp.image_url !== null) { %>
										<img src="<%= dp.image_url %>" srcset="<%= dp.image_url_2x %> 2x" alt="" class="p-admin-astore-list__image" />
										<% } else { %>
										<img src="/assets/image/amazon_noimage.svg" alt="" class="p-admin-astore-list__image" />
										<% } %> <% if (dp.binding !== null) { %>
										<span class="p-admin-astore-list__title"><%= dp.title %></span>
										<% } else { %>
										<span class="p-admin-astore-list__title"><%= dp.title %><b>[<%= dp.binding %>]</b></span>
										<% } %>
									</a>
									<% if (dp.date !== null) { %>
									<span class="p-admin-astore-list__date"><%= dp.date.format('YYYY年M月D日') %></span>
									<% } %>
								</div>
								<ul class="p-admin-astore-list__code">
									<li><%= dp.url %></li>
									<% if (dp.image_url !== null) { %>
									<li><%= dp.image_url %></li>
									<% } %>
								</ul>
							</li>
							<% } %>
						</ul>
					</section>
					<% } %>
				</div>
			</main>

			<%- include('./_include/_footer') %>
		</div>
	</body>
</html>
